# -*- coding: utf-8 -*-
"""get_likes.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1xQHRAge9XN4nHDWJVX4Y0MfUj4LGzbE3
"""

import csv
import vk
import time
from itertools import count
#import user_info_constants
import numpy as np
import pandas as pd

from google.colab import drive
drive.mount('/content/gdrive')

token = 'ef96c0a2ef96c0a2ef96c0a25befe05fdaeef96ef96c0a28fafeeb6ddabe8c8d15a9afa'
last_user = 10000
version = 5.92
scope='users,wall,likes'
all_posts=[]
post=[]
a=[]
def get_likes(vk_api, owner_id, item_id):    
    response = vk_api.likes.getList(type='post', owner_id=owner_id, item_id=item_id, v=version)
    list_users = list(response.values())
    
    return list_users


session = vk.Session(access_token=token)
vk_api = vk.API(session)

with open(f'/content/gdrive/My Drive/vk_dataset/posts_3.csv', 'r', encoding='utf-8') as file: 
  file_reader = csv.reader(file)
  for row in file_reader:
    if row[2]=='owner_id':
        all_posts = [['owner_id', 'post_id', 'likes', 'items']]
        continue
    else:
      
      post = get_likes(vk_api, row[2], row[1])
      a.append(row[2])
      a.append(row[1])
      a.extend(post)
      all_posts.append(a)
      post=[]
      a=[]


pd.DataFrame(all_posts).to_csv(f'/content/gdrive/My Drive/likes_3.csv')

!pip install vk