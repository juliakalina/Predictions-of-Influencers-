# -*- coding: utf-8 -*-
"""Get_id.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1jFAKqqyRp-HRFmBRoETl7ow4OKVD99uB
"""

from json import JSONEncoder
import vk
import time
from itertools import count
#import user_info_constants
import numpy as np
import pandas as pd

from google.colab import drive
drive.mount('/content/gdrive')

def filemaker(data):
    with open(f'/content/gdrive/My Drive/ids.json', 'w', encoding='utf-8') as file:
        file.write(JSONEncoder().encode(data))

token = 'ef96c0a2ef96c0a2ef96c0a25befe05fdaeef96ef96c0a28fafeeb6ddabe8c8d15a9afa'
last_user = 10000
version = 5.92
scope='users,wall'
fields = 'followers_count'

def get_users(vk_api, user_ids):
    assert len(user_ids) <= 1000
    response = vk_api.users.get(user_ids=user_ids, fields=fields, can_access_closed=True, v=version)
    list_users = list(response)
    return list_users

session = vk.Session(access_token=token)
vk_api = vk.API(session, scope=scope)
from_id = last_user
to_id = 20000
step = 999
for num, user_bound in enumerate(range(from_id, to_id, step)):
    user_ids = np.arange(user_bound-step, user_bound)
    try:
        print(f"[{user_ids[0]}..{user_ids[-1]}]")
        time.sleep(3)
        users_info = get_users(vk_api, user_ids)
        pd.DataFrame(users_info).to_csv(f'/content/gdrive/My Drive/ids.csv')
    except:
        print(f"error {num}")
